1. Create a Kinesis Data Firehose Stream

Kinesis Data Firehose will act as the pipeline to send logs from CloudWatch to OpenSearch.
Steps:

    Go to AWS Console â†’ Kinesis â†’ Create Delivery Stream
    Choose Source:
        Select Direct PUT or other sources (CloudWatch will push logs to this Firehose stream).
    Choose Destination:
        Select Amazon OpenSearch Service if using AWS OpenSearch.
        If using a standalone self-managed OpenSearch, choose Amazon S3 and set up a Lambda function to forward logs to OpenSearch manually.
    Set Buffer Conditions:
        Buffer size: 5MB (default)
        Buffer interval: 60 seconds
    Configure Index Rotation:
        Index pattern: cloudwatch-logs-{date}
    IAM Role for Firehose:
        Grant Kinesis permission to write to OpenSearch (AmazonOpenSearchServiceFullAccess).
    Create Stream.

2. Enable CloudWatch Logs Subscription Filter

CloudWatch Logs needs to forward log data to Kinesis Firehose.
Steps:

    Go to AWS Console â†’ CloudWatch â†’ Log Groups
    Select the log group (e.g., /aws/lambda/my-function-logs).
    Click Actions â†’ Create Subscription Filter.
    Destination: Choose Amazon Kinesis Data Firehose.
    Select the Kinesis Firehose stream created earlier.
    Set filter pattern (leave "" to send all logs).
    Click Start Streaming.

3. Deploy a Standalone OpenSearch Cluster

You can install OpenSearch on EC2 or use a self-managed OpenSearch cluster.
Option 1: Deploy OpenSearch on EC2

    Launch an EC2 instance (Ubuntu 22.04 or Amazon Linux).
    Install OpenSearch:

wget https://artifacts.opensearch.org/releases/bundle/opensearch/2.12.0/opensearch-2.12.0-linux-x64.tar.gz
tar -xzf opensearch-2.12.0-linux-x64.tar.gz
cd opensearch-2.12.0
./opensearch-tar-install.sh

Edit OpenSearch Configuration (opensearch.yml):

network.host: 0.0.0.0
discovery.type: single-node

Start OpenSearch:

./bin/opensearch &

Allow OpenSearch Traffic (Optional, if using public access):

    sudo ufw allow 9200/tcp

4. Validate Log Flow
Test the Data Pipeline

After setting up Kinesis and OpenSearch:

    Check CloudWatch Logs â†’ Subscription Filters (ensure Kinesis is receiving logs).
    In OpenSearch, verify logs:

    curl -X GET "http://your-opensearch-endpoint:9200/cloudwatch-logs-*/_search?pretty"

    Use OpenSearch Dashboards to visualize logs.

Additional Considerations

âœ… Security:

    Restrict OpenSearch access via IAM roles, VPC, or IP whitelisting.
    Enable TLS for OpenSearch connections.

âœ… Performance Tuning:

    Use Kinesis Firehose buffering to control log write frequency.
    Set OpenSearch index lifecycle policies to delete old logs.

âœ… Error Handling:

    Check Kinesis error logs in CloudWatch if logs are missing.
    Verify IAM roles assigned to Kinesis and OpenSearch.

Let me know if you need help troubleshooting! ðŸš€
