1. Create a Kinesis Data Firehose Stream

Kinesis Data Firehose will act as the pipeline to send logs from CloudWatch to OpenSearch.
Steps:

    Go to AWS Console â†’ Kinesis â†’ Create Delivery Stream
    Choose Source:
        Select Direct PUT or other sources (CloudWatch will push logs to this Firehose stream).
    Choose Destination:
        Select Amazon OpenSearch Service if using AWS OpenSearch.
        If using a standalone self-managed OpenSearch, choose Amazon S3 and set up a Lambda function to forward logs to OpenSearch manually.
    Set Buffer Conditions:
        Buffer size: 5MB (default)
        Buffer interval: 60 seconds
    Configure Index Rotation:
        Index pattern: cloudwatch-logs-{date}
    IAM Role for Firehose:
        Grant Kinesis permission to write to OpenSearch (AmazonOpenSearchServiceFullAccess).
    Create Stream.

2. Enable CloudWatch Logs Subscription Filter

CloudWatch Logs needs to forward log data to Kinesis Firehose.
Steps:

    Go to AWS Console â†’ CloudWatch â†’ Log Groups
    Select the log group (e.g., /aws/lambda/my-function-logs).
    Click Actions â†’ Create Subscription Filter.
    Destination: Choose Amazon Kinesis Data Firehose.
    Select the Kinesis Firehose stream created earlier.
    Set filter pattern (leave "" to send all logs).
    Click Start Streaming.

3. Deploy a Standalone OpenSearch Cluster

You can install OpenSearch on EC2 or use a self-managed OpenSearch cluster.
Option 1: Deploy OpenSearch on EC2

    Launch an EC2 instance (Ubuntu 22.04 or Amazon Linux).
    Install OpenSearch:

wget https://artifacts.opensearch.org/releases/bundle/opensearch/2.12.0/opensearch-2.12.0-linux-x64.tar.gz
tar -xzf opensearch-2.12.0-linux-x64.tar.gz
cd opensearch-2.12.0
./opensearch-tar-install.sh

Edit OpenSearch Configuration (opensearch.yml):

network.host: 0.0.0.0
discovery.type: single-node

Start OpenSearch:

./bin/opensearch &

Allow OpenSearch Traffic (Optional, if using public access):

    sudo ufw allow 9200/tcp

4. Validate Log Flow
Test the Data Pipeline

After setting up Kinesis and OpenSearch:

    Check CloudWatch Logs â†’ Subscription Filters (ensure Kinesis is receiving logs).
    In OpenSearch, verify logs:

    curl -X GET "http://your-opensearch-endpoint:9200/cloudwatch-logs-*/_search?pretty"

    Use OpenSearch Dashboards to visualize logs.

Additional Considerations

âœ… Security:

    Restrict OpenSearch access via IAM roles, VPC, or IP whitelisting.
    Enable TLS for OpenSearch connections.

âœ… Performance Tuning:

    Use Kinesis Firehose buffering to control log write frequency.
    Set OpenSearch index lifecycle policies to delete old logs.

âœ… Error Handling:

    Check Kinesis error logs in CloudWatch if logs are missing.
    Verify IAM roles assigned to Kinesis and OpenSearch.

Let me know if you need help troubleshooting! ðŸš€


=========================================================

1. Ensure You Are Using Kinesis Data Firehose (Not Kinesis Data Streams)

AWS Kinesis has multiple services:

    Kinesis Data Streams â†’ For real-time streaming data (not what we need).
    Kinesis Data Firehose â†’ Used for sending data to OpenSearch, S3, etc.

ðŸ”¹ Fix:
Go to AWS Console â†’ Kinesis â†’ Data Firehose, then look for "Create Delivery Stream".
ðŸ‘‰ Direct Link: AWS Kinesis Data Firehose
2. Check AWS Region

Not all AWS regions support Kinesis Data Firehose. If the option is missing:
ðŸ”¹ Fix:

    In the AWS Console, switch to a supported region like us-east-1 (N. Virginia) or us-west-2 (Oregon).
    Try accessing Kinesis Data Firehose again.

3. Check IAM Permissions

If your AWS user/account does not have the required permissions, the Create Delivery Stream option will be missing.

ðŸ”¹ Fix:
Ask your AWS admin to grant these permissions to your IAM user:

{
    "Effect": "Allow",
    "Action": [
        "firehose:CreateDeliveryStream",
        "firehose:PutRecord",
        "firehose:PutRecordBatch",
        "firehose:DescribeDeliveryStream",
        "firehose:ListDeliveryStreams"
    ],
    "Resource": "*"
}

ðŸ‘‰ Steps to Check Permissions:

    Go to AWS Console â†’ IAM â†’ Users.
    Select your IAM User.
    Click Permissions â†’ Add Permissions.
    Attach the policy "AmazonKinesisFirehoseFullAccess".

4. Use AWS CLI to Create a Firehose Stream (Alternative)

If the AWS Console is missing the option, try creating the stream using AWS CLI.

ðŸ”¹ Command to Create a Kinesis Firehose Stream for OpenSearch:

aws firehose create-delivery-stream \
  --delivery-stream-name MyFirehoseStream \
  --delivery-stream-type DirectPut \
  --opensearch-destination-configuration \
  ClusterEndpoint="https://your-opensearch-endpoint",IndexName="cloudwatch-logs",RoleARN="arn:aws:iam::123456789012:role/firehose-role"

ðŸ‘‰ Check Firehose Streams:

aws firehose list-delivery-streams

5. Check AWS Service Quotas

If your AWS account has reached the limit for Kinesis Firehose Streams, you may not be able to create new ones.

ðŸ”¹ Fix:

    Go to AWS Console â†’ Service Quotas.
    Search for "Kinesis Data Firehose Delivery Streams".
    If at the limit, request a quota increase.

âœ… Final Steps to Fix

    Ensure you're in Kinesis Data Firehose (not Kinesis Data Streams).
    Check AWS region (use us-east-1 or another supported region).
    Verify IAM permissions (AmazonKinesisFirehoseFullAccess).
    Use AWS CLI if the console option is missing.
    Check service quotas if you hit Firehose limits.

Let me know if you need more help! ðŸš€

